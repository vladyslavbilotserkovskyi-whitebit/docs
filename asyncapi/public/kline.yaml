asyncapi: 3.0.0
info:
  title: WhiteBit Kline Data
  version: 1.0.0
  description: Historical and real-time kline (candlestick) data for trading pairs. Supports both one-time queries and subscription-based updates.

servers:
  production:
    host: api.whitebit.com
    protocol: wss
    description: WhiteBIT Production Server
  eu:
    host: api.whitebit.eu
    protocol: wss
    description: WhiteBIT EU Server

channels:
  /ws:
    address: /ws
    description: |
      Candlestick data operations.

      **Update Interval**: 0.5 seconds (for subscriptions)

      **Interval Constraints**:
      - Less than 60: must be divisible into 60 without remainder
      - Less than 3600 (1h): must be divisible by 60, and 3600 must be divisible by it
      - Less than 86400 (1d): must be divisible by 3600, and 86400 must be divisible by it
      - Less than 604800 (1w): must be divisible by 86400
      - Equal to 604800 (1w) or 2592000 (30d)
    messages:
      candlesRequest:
        $ref: '#/components/messages/candlesRequest'
      candlesResponse:
        $ref: '#/components/messages/candlesResponse'
      candlesSubscribe:
        $ref: '#/components/messages/candlesSubscribe'
      candlesSubscribeResponse:
        $ref: '#/components/messages/candlesSubscribeResponse'
      candlesUpdate:
        $ref: '#/components/messages/candlesUpdate'
      candlesUnsubscribe:
        $ref: '#/components/messages/candlesUnsubscribe'

operations:
  sendCandlesRequest:
    action: receive
    channel:
      $ref: '#/channels/~1ws'
    messages:
      - $ref: '#/channels/~1ws/messages/candlesRequest'

  receiveCandlesResponse:
    action: send
    channel:
      $ref: '#/channels/~1ws'
    messages:
      - $ref: '#/channels/~1ws/messages/candlesResponse'

  sendCandlesSubscribe:
    action: receive
    channel:
      $ref: '#/channels/~1ws'
    messages:
      - $ref: '#/channels/~1ws/messages/candlesSubscribe'

  receiveCandlesSubscribeResponse:
    action: send
    channel:
      $ref: '#/channels/~1ws'
    messages:
      - $ref: '#/channels/~1ws/messages/candlesSubscribeResponse'

  receiveCandlesUpdates:
    action: send
    description: Receive periodic candlestick updates every 0.5 seconds
    channel:
      $ref: '#/channels/~1ws'
    messages:
      - $ref: '#/channels/~1ws/messages/candlesUpdate'

  sendCandlesUnsubscribe:
    action: receive
    channel:
      $ref: '#/channels/~1ws'
    messages:
      - $ref: '#/channels/~1ws/messages/candlesUnsubscribe'

components:
  messages:
    candlesRequest:
      name: CandlesRequest
      title: Candlestick Query
      summary: Request historical candlestick data for a market pair
      payload:
        $ref: '#/components/schemas/CandlesRequest'
      examples:
        - name: candlesQuery
          summary: Request candles for 1 hour interval
          payload:
            id: 2
            method: candles_request
            params:
              - ETH_BTC
              - 1659569940
              - 1660894800
              - 3600

    candlesResponse:
      name: CandlesResponse
      title: Candlestick Response
      summary: Array of historical candlestick data
      payload:
        $ref: '#/components/schemas/CandlesResponse'
      examples:
        - name: candlesData
          summary: Candlestick data
          payload:
            id: 2
            result:
              - - 1580860800
                - "0.020543"
                - "0.020553"
                - "0.020614"
                - "0.02054"
                - "7342.597"
                - "151.095481849"
                - ETH_BTC
            error: null

    candlesSubscribe:
      name: CandlesSubscribe
      title: Subscribe to Candlesticks
      summary: Subscribe to periodic candlestick updates
      payload:
        $ref: '#/components/schemas/CandlesSubscribe'
      examples:
        - name: subscribeCandles
          summary: Subscribe to 15 minute candles
          payload:
            id: 3
            method: candles_subscribe
            params:
              - BTC_USD
              - 900

    candlesSubscribeResponse:
      name: CandlesSubscribeResponse
      title: Subscribe Response
      summary: Subscription confirmation
      payload:
        $ref: '#/components/schemas/SubscriptionResponse'
      examples:
        - name: subscribeSuccess
          summary: Subscription successful
          payload:
            id: 3
            result:
              status: success
            error: null

    candlesUpdate:
      name: CandlesUpdate
      title: Candlestick Update
      summary: Periodic candlestick update (every 0.5 seconds)
      payload:
        $ref: '#/components/schemas/CandlesUpdate'
      examples:
        - name: candleUpdate
          summary: New candle update
          payload:
            id: null
            method: candles_update
            params:
              - - 1580895000
                - "0.020683"
                - "0.020683"
                - "0.020683"
                - "0.020666"
                - "504.701"
                - "10.433600491"
                - ETH_BTC

    candlesUnsubscribe:
      name: CandlesUnsubscribe
      title: Unsubscribe from Candlesticks
      summary: Stop receiving candlestick updates
      payload:
        $ref: '#/components/schemas/UnsubscribeRequest'
      examples:
        - name: unsubscribeCandles
          summary: Unsubscribe from candlestick updates
          payload:
            id: 4
            method: candles_unsubscribe
            params: []

  schemas:
    Candle:
      type: array
      minItems: 8
      maxItems: 8
      items:
        - type: integer
          description: Time (Unix timestamp)
        - type: string
          description: Open price
        - type: string
          description: Close price
        - type: string
          description: High price
        - type: string
          description: Low price
        - type: string
          description: Volume in stock
        - type: string
          description: Volume in deal (money)
        - type: string
          description: Market pair

    CandlesRequest:
      type: object
      required:
        - id
        - method
        - params
      properties:
        id:
          type: integer
          description: Unique request identifier
        method:
          const: candles_request
        params:
          type: array
          minItems: 4
          maxItems: 4
          items:
            - type: string
              description: Market name (e.g., ETH_BTC)
            - type: integer
              description: Start time (Unix timestamp)
            - type: integer
              description: End time (Unix timestamp)
            - type: integer
              description: Interval in seconds

    CandlesResponse:
      type: object
      required:
        - id
        - result
        - error
      properties:
        id:
          type: integer
          description: Request identifier matching the request
        result:
          type: array
          items:
            $ref: '#/components/schemas/Candle'
        error:
          type: "null"

    CandlesSubscribe:
      type: object
      required:
        - id
        - method
        - params
      properties:
        id:
          type: integer
          description: Unique request identifier
        method:
          const: candles_subscribe
        params:
          type: array
          minItems: 2
          maxItems: 2
          items:
            - type: string
              description: Market name (e.g., BTC_USD)
            - type: integer
              description: Interval in seconds

    SubscriptionResponse:
      type: object
      required:
        - id
        - result
        - error
      properties:
        id:
          type: integer
        result:
          type: object
          required:
            - status
          properties:
            status:
              type: string
              enum: [success]
        error:
          type: "null"

    CandlesUpdate:
      type: object
      required:
        - id
        - method
        - params
      properties:
        id:
          type: "null"
        method:
          const: candles_update
        params:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/Candle'

    UnsubscribeRequest:
      type: object
      required:
        - id
        - method
        - params
      properties:
        id:
          type: integer
          description: Unique request identifier
        method:
          type: string
          enum: [candles_unsubscribe]
        params:
          type: array
          items: {}
          maxItems: 0